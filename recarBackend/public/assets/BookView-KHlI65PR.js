var I=Object.defineProperty;var F=(e,u,t)=>u in e?I(e,u,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[u]=t;var v=(e,u,t)=>(F(e,typeof u!="symbol"?u+"":u,t),t);import{B as y,K as $,d as C,_ as w,a as S,w as a,r as i,o as E,g as o,b as s,k as q,L as A,z as U,D as R,m as z,M as T,c as j,i as M,q as P,t as r,x as D,p as N,h as x}from"./index-CfCwTioh.js";class H extends y{constructor(){super({date_issue:"",date_return:""})}checkDateIssue(u){let t=!1;return u.date_issue==null?this.errors.value.date_issue="Укажите дату начала аренды":(t=!0,this.errors.value.date_issue=""),t}checkDateReturn(u){let t=!1;return u.date_return==null?this.errors.value.date_return="Укажите дату окончания аренды":(t=!0,this.errors.value.date_return=""),t}checkInterval(u){let t=!1;return u.date_return-u.date_issue<=0?(this.errors.value.date_return="Некорректный диапазон",this.errors.value.date_issue="Некорректный диапазон"):(this.errors.value.date_return="",this.errors.value.date_issue="",t=!0),t}}class O{constructor(){v(this,"state");this.state=$({showDialog:!1})}getShowDialog(){return this.state.showDialog}getValueFromChild(u){this.state.showDialog=u}toggleDialog(){this.state.showDialog=!this.state.showDialog}}const G=C({name:"AIPredictDialogComponent",emits:["sendShowDialog"],props:{showDialog:{type:Boolean,required:!0}},methods:{sendShowDialog(){this.$emit("sendShowDialog",!this.showDialog)}}}),K=s("p",{class:"text-justify"}," На основе анализа системой предупреждения ДТП текущих условий, характеристик авто и вашего опыта, мы рекомендуем вам воздержаться от управления выбранным автомобилем в данный момент. Пожалуйста, рассмотрите возможность использования альтернативного транспорта или подождите, пока ситуация улучшится. ",-1);function L(e,u,t,n,f,k){const g=i("font-awesome-icon"),c=i("v-btn"),l=i("v-card"),_=i("v-dialog");return E(),S(_,{modelValue:e.showDialog,"onUpdate:modelValue":u[0]||(u[0]=p=>e.showDialog=p),width:"auto"},{default:a(()=>[o(l,{color:"red-darken-3","max-width":"500",title:"Система безопасности"},{prepend:a(()=>[o(g,{icon:"fa-solid fa-ban",size:"lg",style:{color:"white"}})]),text:a(()=>[K]),actions:a(()=>[o(c,{class:"ms-auto",text:"Ok",onClick:e.sendShowDialog},null,8,["onClick"])]),_:1})]),_:1},8,["modelValue"])}const J=w(G,[["render",L]]),Q=C({name:"CardComponent",components:{AIPredictDialogComponent:J},data:()=>({car:{model_id:"",equip_id:""},total_cost:0,date_issue:null,date_return:null,car_name:"",equip_name:"",peop_in_car:0,cost:0,loading:!1}),created(){window.scrollTo(0,0),this.car=this.$store.getters.getReservationData,this.car.model_id?(q.getCarById({id:this.car.model_id},e=>{const u=e.data;this.car_name=u.brand+" "+u.name},e=>{}),A.getEquipmentsById({id:this.car.model_id},e=>{const t=e.data.find(({equip_id:n})=>n===parseInt(this.car.equip_id));this.equip_name=t.name,this.cost=t.price})):this.$router.push({name:"catalog_all"})},computed:{...U(["getUserID"]),minDate(){return new Date(Date.now()-24*60*60*1e3).toISOString()}},mixins:[R],methods:{...z(["createReservation"]),getValueFromChild(e){this.bookDialog.getValueFromChild(e)},validate(e){let u=this.bookValidation.checkDateReturn(this);this.bookValidation.checkDateIssue(this)&&u&&this.bookValidation.checkInterval(this)&&e()},pay(){this.validate(()=>{this.loading=!0,T.createReservation({model_id:this.car.model_id,equip_id:this.car.equip_id,date_issue:this.toIsoString(this.date_issue),date_return:this.toIsoString(this.date_return),total_cost:this.total_cost,peop_in_car:this.peop_in_car},e=>{this.$toastr.success(e.message),this.loading=!1,this.$router.push({name:"catalog_all"})},e=>{if(e.response.status!=null&&e.response.status===503)throw console.info("оповещение системы безопасности"),this.bookDialog.toggleDialog(),this.loading=!1,new Error("ai_safety_error");const u=["model_id","eqiup_id","date_issue","date_return","total_cost","peop_in_car"];this.loading=!1,j(u,n=>{this.$toastr.error(n.pop())}).handle(e)})})},increment(){this.peop_in_car++},decrement(){this.peop_in_car>0&&this.peop_in_car--},calculate(){this.validate(()=>{let e=this.date_return.getTime()-this.date_issue.getTime(),u=Math.round(e/(1e3*3600*24));this.total_cost=u*this.cost})},abort(){this.createReservation({equip_id:"",model_id:""}),this.$router.push({name:"catalog_all"})}},setup(){const e=new H,u=new O;return{bookValidation:e,bookDialog:u,errors:e.getErrors()}}}),d=e=>(N("data-v-fc6223f0"),e=e(),x(),e),W={id:"book-page"},X=d(()=>s("div",{class:"text-center mb-3"},[s("h2",{class:"font-weight-medium"},"Бронирование")],-1)),Y={class:"img-wrapper position-relative"},Z=d(()=>s("div",{class:"bg-img-auto position-absolute"},null,-1)),ee={class:"text-h6"},ue={style:{"font-size":"15px"}},te=d(()=>s("small",null,"Стоимость",-1)),oe={class:"text-h5 text-price"},se={class:"font-weight-bold"},ae={class:"mt-4"},ie={class:"mt-1"},ne=d(()=>s("p",{class:"text-center"},"Количество людей в машине",-1)),le={class:"text-h5"},re={class:"d-flex align-center justify-end"},de=d(()=>s("b",{class:"text-h5 font-weight-medium me-2"},"К оплате: ",-1)),ce={class:"text-h5 font-weight-medium"},_e={class:"button-group mt-5"};function pe(e,u,t,n,f,k){const g=i("v-img"),c=i("v-divider"),l=i("v-sheet"),_=i("v-date-input"),p=i("font-awesome-icon"),h=i("v-btn"),B=i("v-col"),b=i("v-row"),V=i("AIPredictDialogComponent");return E(),M(P,null,[o(b,null,{default:a(()=>[o(B,null,{default:a(()=>[s("div",W,[X,s("div",Y,[Z,o(g,{height:"100",rounded:"",cover:"",src:"../src/assets/auto.jpg"})]),o(c,{class:"my-3"}),o(l,{class:"car-name px-4 py-3",rounded:""},{default:a(()=>[s("p",ee,r(e.car_name),1),s("p",ue,r(e.equip_name),1)]),_:1}),o(l,{class:"mt-3 px-4 py-3 price",rounded:""},{default:a(()=>[te,s("p",oe,[s("b",se,r(e.cost)+"₽",1),D("/день")])]),_:1}),s("div",ae,[o(_,{modelValue:e.date_issue,"onUpdate:modelValue":[u[0]||(u[0]=m=>e.date_issue=m),e.calculate],label:"Начало аренды","prepend-icon":"",min:e.minDate,"error-messages":e.errors.date_issue},null,8,["modelValue","min","error-messages","onUpdate:modelValue"])]),s("div",null,[o(_,{modelValue:e.date_return,"onUpdate:modelValue":[u[1]||(u[1]=m=>e.date_return=m),e.calculate],label:"Конец аренды","prepend-icon":"",min:e.minDate,"error-messages":e.errors.date_return},null,8,["modelValue","min","error-messages","onUpdate:modelValue"])]),s("div",ie,[ne,o(l,{class:"px-4 py-2 d-flex justify-space-between align-center"},{default:a(()=>[o(h,{icon:"",variant:"tonal",onClick:e.decrement},{default:a(()=>[o(p,{icon:"fa-solid fa-minus",size:"lg",style:{color:"black"}})]),_:1},8,["onClick"]),s("p",le,r(e.peop_in_car),1),o(h,{icon:"",variant:"tonal",onClick:e.increment},{default:a(()=>[o(p,{icon:"fa-solid fa-plus",size:"lg",style:{color:"black"}})]),_:1},8,["onClick"])]),_:1})]),o(c,{class:"mb-5 mt-2"}),s("div",re,[de,s("b",ce,r(e.total_cost)+"₽",1)]),s("div",_e,[o(h,{onClick:u[2]||(u[2]=m=>e.pay()),block:"",color:"green",class:"mb-3",size:"large",variant:"elevated",loading:e.loading},{default:a(()=>[D(" Оплатить ")]),_:1},8,["loading"]),o(h,{onClick:e.abort,block:"",color:"red-darken-1",variant:"outlined"},{default:a(()=>[D(" Отменить ")]),_:1},8,["onClick"])])])]),_:1})]),_:1}),o(V,{"show-dialog":e.bookDialog.getShowDialog(),onSendShowDialog:e.getValueFromChild},null,8,["show-dialog","onSendShowDialog"])],64)}const ge=w(Q,[["render",pe],["__scopeId","data-v-fc6223f0"]]);export{ge as default};
