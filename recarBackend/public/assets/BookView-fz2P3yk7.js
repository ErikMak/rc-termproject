import{d as V,s as k,C as b,j as C,m as w,D as B,t as v,_ as q,c as y,w as l,r,o as E,h as i,a as t,f as d,n as _}from"./index-Bmvq8wfM.js";const $=V({name:"CardComponent",data:()=>({car:{model_id:"",equip_id:""},total_cost:0,date_issue:null,date_return:null,car_name:"",equip_name:"",cost:0,date_issue_error:"",date_return_error:""}),created(){window.scrollTo(0,0),this.car=this.$store.getters.getReservationData,this.car.model_id?(k.getCarById({id:this.car.model_id},e=>{const s=e.data;this.cost=parseFloat(s.price),this.car_name=s.brand+" "+s.name}),b.getEquipmentsById({id:this.car.model_id},e=>{const u=e.data.find(({equip_id:a})=>a===parseInt(this.car.equip_id));this.equip_name=u.name})):this.$router.push("/catalog")},computed:{...C(["getUserID"])},methods:{...w(["createReservation"]),toIsoString(e){var s=-e.getTimezoneOffset(),u=s>=0?"+":"-",a=function(o){return(o<10?"0":"")+o};return e.getFullYear()+"-"+a(e.getMonth()+1)+"-"+a(e.getDate())+"T"+a(e.getHours())+":"+a(e.getMinutes())+":"+a(e.getSeconds())+u+a(Math.floor(Math.abs(s)/60))+":"+a(Math.abs(s)%60)},checkDateIssue(){let e=!1;return this.date_issue==null?this.date_issue_error="Укажите дату начала аренды":(e=!0,this.date_issue_error=""),e},checkDateReturn(){let e=!1;return this.date_return==null?this.date_return_error="Укажите дату окончания аренды":(e=!0,this.date_return_error=""),e},checkInterval(){let e=!1;return this.date_return-this.date_issue<=0?(this.date_issue_error="Некорректный диапазон",this.date_return_error="Некорректный диапазон"):(this.date_return_error="",this.date_issue_error="",e=!0),e},pay(){let e=this.checkDateReturn();if(this.checkDateIssue()&&e&&this.checkInterval()){const o=this.getUserID;B.createReservation({user_id:o,model_id:this.car.model_id,equip_id:this.car.equip_id,date_issue:this.toIsoString(this.date_issue),date_return:this.toIsoString(this.date_return),total_cost:this.total_cost},n=>{v.success(n.message),this.$router.push("/catalog")},n=>{v.error(n.error)})}},calculate(){let e=this.checkDateReturn();if(this.checkDateIssue()&&e&&this.checkInterval()){let o=this.date_return.getTime()-this.date_issue.getTime(),n=Math.round(o/(1e3*3600*24));this.total_cost=n*this.cost}},abort(){this.createReservation({equip_id:"",model_id:""}),this.$router.push("/catalog")}}}),R={id:"book-page"},S=t("div",{class:"text-center mb-3"},[t("h2",{class:"font-weight-medium"},"Бронирование")],-1),M={class:"img-wrapper position-relative"},T=t("div",{class:"bg-img-auto position-absolute"},null,-1),U={class:"text-h6"},A={style:{"font-size":"15px"}},z=t("small",null,"Стоимость",-1),F={class:"text-h5 text-price"},j={class:"font-weight-bold"},N={class:"mt-4"},O={class:"d-flex align-center justify-end"},x=t("b",{class:"text-h5 font-weight-medium me-2"},"К оплате: ",-1),G={class:"text-h5 font-weight-medium"},H={class:"button-group mt-5"};function Y(e,s,u,a,o,n){const f=r("v-img"),h=r("v-divider"),m=r("v-sheet"),p=r("v-date-input"),g=r("v-btn"),D=r("v-col"),I=r("v-row");return E(),y(I,null,{default:l(()=>[i(D,null,{default:l(()=>[t("div",R,[S,t("div",M,[T,i(f,{height:"100",rounded:"",cover:"",src:"../src/assets/auto.jpg"})]),i(h,{class:"my-3"}),i(m,{class:"car-name px-4 py-3",rounded:""},{default:l(()=>[t("p",U,d(e.car_name),1),t("p",A,d(e.equip_name),1)]),_:1}),i(m,{class:"mt-3 px-4 py-3 price",rounded:""},{default:l(()=>[z,t("p",F,[t("b",j,"$"+d(e.cost),1),_("/день")])]),_:1}),t("div",N,[i(p,{modelValue:e.date_issue,"onUpdate:modelValue":[s[0]||(s[0]=c=>e.date_issue=c),e.calculate],label:"Начало аренды","prepend-icon":"",min:new Date(Date.now()-24*60*60*1e3).toISOString(),"error-messages":e.date_issue_error},null,8,["modelValue","min","error-messages","onUpdate:modelValue"])]),t("div",null,[i(p,{modelValue:e.date_return,"onUpdate:modelValue":[s[1]||(s[1]=c=>e.date_return=c),e.calculate],label:"Конец аренды","prepend-icon":"",min:new Date(Date.now()-24*60*60*1e3).toISOString(),"error-messages":e.date_return_error},null,8,["modelValue","min","error-messages","onUpdate:modelValue"])]),i(h,{class:"mb-5"}),t("div",O,[x,t("b",G,d(e.total_cost)+"$",1)]),t("div",H,[i(g,{onClick:e.pay,block:"",color:"green",class:"mb-3",size:"large",variant:"elevated"},{default:l(()=>[_(" Оплатить ")]),_:1},8,["onClick"]),i(g,{onClick:e.abort,block:"",color:"red-darken-1",variant:"outlined"},{default:l(()=>[_(" Отменить ")]),_:1},8,["onClick"])])])]),_:1})]),_:1})}const K=q($,[["render",Y]]);export{K as default};
